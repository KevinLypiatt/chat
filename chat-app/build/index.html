<!doctype html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>French Language Learning Chat</title><style>body{font-family:Arial,sans-serif;text-align:center}.chat-container{width:80%;max-width:600px;margin:20px auto;text-align:left}.bubble{padding:10px;margin:5px;border-radius:10px;max-width:70%}.user{background:#007bff;color:#fff;align-self:flex-end}.ai{background:#f1f1f1;color:#000;align-self:flex-start;display:flex;align-items:center}.chat-box{display:flex;flex-direction:column;gap:10px}button{padding:10px 15px;margin:10px;cursor:pointer}.level-indicator{display:flex;gap:2px;width:100px;height:20px;margin:10px auto}.level-bar{flex:1;background:#ccc;border-radius:2px}.level-bar.active-1{background:#a7e8a0}.level-bar.active-2{background:#7ed475}.level-bar.active-3{background:#5dc157}.level-bar.active-4{background:#4a9c44}.level-bar.active-5{background:#2e7729}.play-button{background:#4caf50;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;display:inline-block;margin-left:10px}.language-level{margin:10px auto;display:flex;justify-content:center;gap:10px}.level-btn{padding:5px 12px;border-radius:15px;border:none;cursor:pointer;font-weight:700}.level-btn.active{background-color:#4a9c44;color:#fff}.level-btn.beginner{background-color:#a7e8a0;color:#333}.level-btn.intermediate{background-color:#5dc157;color:#fff}.level-btn.advanced{background-color:#2e7729;color:#fff}.learning-tip{background-color:#f8f9fa;border-left:4px solid #4a9c44;padding:10px;margin:10px 0;font-style:italic;color:#555}</style><link href="/static/css/main.a2729b5d.chunk.css" rel="stylesheet"></head><body><h2>Apprenez le Fran√ßais - Chat Vocal</h2><div class="language-level"><button id="level-beginner" class="level-btn beginner active">D√©butant</button> <button id="level-intermediate" class="level-btn intermediate">Interm√©diaire</button> <button id="level-advanced" class="level-btn advanced">Avanc√©</button></div><div class="chat-container"><div id="chat-box" class="chat-box"><div class="learning-tip">Bonjour! Je suis votre tuteur de fran√ßais. Parlez-moi en fran√ßais, et je vous aiderai √† am√©liorer votre prononciation et votre grammaire.</div></div></div><div id="level-indicator" class="level-indicator"><div class="level-bar" id="level-1"></div><div class="level-bar" id="level-2"></div><div class="level-bar" id="level-3"></div><div class="level-bar" id="level-4"></div><div class="level-bar" id="level-5"></div></div><button id="start-btn">üé§ Commencer √† parler</button> <button id="stop-btn" disabled="disabled">‚èπÔ∏è Arr√™ter</button><script>const audioResponses=new Map;let mediaRecorder,audioContext,analyzer,microphone,animationId,audioResponseCounter=0,audioChunks=[];function getSupportedMimeType(){const e=["audio/webm","audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/wav","audio/mp3",""];for(const o of e)if(""===o||MediaRecorder.isTypeSupported(o))return console.log("Using MIME type:",o||"browser default"),o;throw new Error("No supported audio MIME type found")}function updateVolumeMeter(e){const o=new Uint8Array(e.frequencyBinCount);!function t(){animationId=requestAnimationFrame(t),e.getByteFrequencyData(o);let n=0;for(let e=0;e<o.length;e++)n+=o[e];const a=n/o.length,d=Math.ceil(a/255*5);for(let e=1;e<=5;e++){const o=document.getElementById("level-"+e);o.className=e<=d?"level-bar active-"+e:"level-bar"}}()}function addMessage(e,o){const t=document.getElementById("chat-box"),n=document.createElement("div");n.classList.add("bubble",o),n.textContent=e,t.appendChild(n),t.scrollTop=t.scrollHeight}function addMessageWithAudio(e,o,t){const n=document.getElementById("chat-box"),a=document.createElement("div");a.classList.add("bubble",o);const d=document.createElement("span");d.textContent=e,a.appendChild(d);const r=document.createElement("button");r.textContent="üîä Play",r.classList.add("play-button"),r.addEventListener("click",()=>{playResponseAudio(t)}),a.appendChild(r),n.appendChild(a),n.scrollTop=n.scrollHeight}function playResponseAudio(e){try{const o=audioResponses.get(e);if(!o)return void console.error("No audio found for ID:",e);const t=new Audio("data:audio/mp3;base64,"+o);console.log("Audio element created:",!!t),t.onplay=()=>console.log("Audio playback started"),t.onended=()=>console.log("Audio playback ended"),t.onerror=e=>console.error("Audio playback error:",e),t.play().catch(e=>{console.error("Audio playback failed:",e)})}catch(e){console.error("Error playing audio:",e)}}function playAudio(e){try{const o="audio-"+audioResponseCounter++;audioResponses.set(o,e),console.log("Audio stored with ID:",o)}catch(e){console.error("Error processing audio:",e)}}document.getElementById("start-btn").addEventListener("click",async()=>{try{if(!audioContext){audioContext=new(window.AudioContext||window.webkitAudioContext);const e=audioContext.createBuffer(1,1,22050),o=audioContext.createBufferSource();o.buffer=e,o.connect(audioContext.destination),o.start(),console.log("Audio context initialized on user interaction")}const e=await navigator.mediaDevices.getUserMedia({audio:!0});analyzer=audioContext.createAnalyser(),analyzer.fftSize=256,microphone=audioContext.createMediaStreamSource(e),microphone.connect(analyzer),updateVolumeMeter(analyzer);const o=getSupportedMimeType();mediaRecorder=new MediaRecorder(e,o?{mimeType:o}:{}),audioChunks=[],mediaRecorder.ondataavailable=e=>{e.data.size>0&&audioChunks.push(e.data)},mediaRecorder.onstart=()=>{console.log("Recording started")},mediaRecorder.onstop=async()=>{animationId&&(cancelAnimationFrame(animationId),animationId=null);for(let e=1;e<=5;e++)document.getElementById("level-"+e).className="level-bar";if(console.log("Recording stopped, chunks:",audioChunks.length),0===audioChunks.length)return console.error("No audio data recorded"),void addMessage("Error: No audio recorded","ai");const e=new Blob(audioChunks,{type:mediaRecorder.mimeType||"audio/webm"});console.log("Blob created, size:",e.size,"type:",e.type);const o=new FormData;o.append("audio",e,"recording.webm"),o.append("level",currentLevel),addMessage("‚è≥ Transcription en cours...","user");try{const e=await fetch("/transcribe",{method:"POST",body:o});if(!e.ok)throw new Error("Server responded with "+e.status);const t=await e.json();console.log("Received response:",t),document.querySelector("#chat-box").lastChild.remove(),addMessage(t.text||"No transcription received","user");const n="audio-"+audioResponseCounter++;audioResponses.set(n,t.audio),addMessageWithAudio(t.response||"No response received","ai",n)}catch(e){console.error("Error sending audio:",e),addMessage("Error: "+e.message,"ai")}},mediaRecorder.start(1e3),document.getElementById("start-btn").disabled=!0,document.getElementById("stop-btn").disabled=!1}catch(e){console.error("Error accessing microphone:",e),addMessage("Error accessing microphone: "+e.message,"ai")}}),document.getElementById("stop-btn").addEventListener("click",()=>{mediaRecorder&&"inactive"!==mediaRecorder.state&&mediaRecorder.stop(),document.getElementById("start-btn").disabled=!1,document.getElementById("stop-btn").disabled=!0});let currentLevel="beginner";function setLanguageLevel(e){currentLevel=e,document.querySelectorAll(".level-btn").forEach(e=>e.classList.remove("active")),document.getElementById("level-"+e).classList.add("active"),sessionStorage.setItem("languageLevel",e),addMessage("Niveau chang√© √†: "+getDisplayLevel(e),"ai")}function getDisplayLevel(e){switch(e){case"beginner":return"D√©butant";case"intermediate":return"Interm√©diaire";case"advanced":return"Avanc√©";default:return"D√©butant"}}document.getElementById("level-beginner").addEventListener("click",()=>setLanguageLevel("beginner")),document.getElementById("level-intermediate").addEventListener("click",()=>setLanguageLevel("intermediate")),document.getElementById("level-advanced").addEventListener("click",()=>setLanguageLevel("advanced"))</script><script>!function(e){function t(t){for(var n,a,p=t[0],l=t[1],f=t[2],c=0,s=[];c<p.length;c++)a=p[c],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&s.push(o[a][0]),o[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(i&&i(t);s.length;)s.shift()();return u.push.apply(u,f||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,p=1;p<r.length;p++){var l=r[p];0!==o[l]&&(n=!1)}n&&(u.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={1:0},u=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var p=this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[],l=p.push.bind(p);p.push=t,p=p.slice();for(var f=0;f<p.length;f++)t(p[f]);var i=l;r()}([])</script><script src="/static/js/2.f22a9755.chunk.js"></script><script src="/static/js/main.d1fa16c2.chunk.js"></script></body></html>